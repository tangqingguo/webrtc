<!DOCTYPE html>
<html lang="zh-cmn-Hans">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Fariry land OA</title>
	<style>
		video{
			height:           480px;
			width:            480px;
			background-color: black;
		}
	</style>
  </head>
  <body>

  	 <table>
	 	<tr><td><video id="display" autoplay/></td><td><video id="display2" autoplay/></td></tr>
		<tr><td colspan="2"><button onclick='onClick();'>Start</button></td></tr>
	 </table>
	 
  </body>
  <!--<script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>-->
  <script src="adapter2.js"></script>
  <script type="text/javascript">        
  	  async function onClick(){
		const stream = await navigator.mediaDevices.getUserMedia({audio:false, video:true});
		display.srcObject = stream;

		const configuration = {};
		pc1 = new RTCPeerConnection(configuration);
		pc2 = new RTCPeerConnection(configuration);

		pc1.addEventListener('icecandidate',e=>{
			onIcecandidate(pc2, e);
		});

		
		pc2.addEventListener('icecandidate',e=>{
			onIcecandidate(pc1, e);
		});		
		pc2.addEventListener('track', (e)=>{
			if (display2.srcObject !== e.streams[0]) {
				display2.srcObject = e.streams[0];
			}			
		});


		stream.getTracks().forEach(track => pc1.addTrack(track, stream));

		offerOptions = {offerToReceiveVideo: 1};

		const offer = await pc1.createOffer(offerOptions);
		await pc1.setLocalDescription(offer);


		
		await pc2.setRemoteDescription(offer);

		const answer = await pc2.createAnswer();
		await pc2.setLocalDescription(answer);
		await pc1.setRemoteDescription(answer);
	  }

	  async function onIcecandidate(pc, event){
		await pc.addIceCandidate(event.candidate);
	  }
  </script>
</html>
